# 2026-02-07 作業実績報告書

**作成日時:** 2026-02-07 06:42  
**作業者:** AI Assistant (Antigravity)  
**タグ:** #作業ログ #開発 #AI家庭教師

## ■ 概要

AI家庭教師Webアプリケーションの開発を実施しました。本セッションでは、学習計画保存機能とメモ機能の追加実装、およびバックエンドAPIの500エラー修正を行いました。主な成果物として、SQLiteデータベースを用いた永続化機能、フロントエンドのUI改善、およびNext.jsとFastAPIの連携修正が完了しました。

## ■ 詳細作業内容

### 1. バックエンド開発 (FastAPI + SQLite)

#### 1.1 データベース設計と実装
- **ファイル作成**: `backend/app/database.py`
  - SQLAlchemy を使用した SQLite データベース接続設定
  - セッション管理用の `get_db()` 依存関数を実装
  - データベースファイル: `backend/ai_tutor.db` (自動生成)

- **ファイル作成**: `backend/app/models.py`
  - `Plan` モデル: 学習計画のタイトル、目標、作成日時
  - `PlanItem` モデル: 計画内の個別タスク、完了状態
  - `Memo` モデル: クイックメモの内容、作成日時
  - リレーションシップ設定: `Plan` ↔ `PlanItem` (1対多、カスケード削除)

#### 1.2 API エンドポイント実装
- **ファイル作成**: `backend/app/routers/plans.py`
  - `POST /api/plans`: 学習計画の新規作成
  - `GET /api/plans`: 計画一覧取得 (作成日時降順)
  - `GET /api/plans/{id}`: 計画詳細取得
  - `PUT /api/plans/{id}/items/{item_id}`: タスク完了状態の更新

- **ファイル作成**: `backend/app/routers/memos.py`
  - `POST /api/memos`: メモ作成
  - `GET /api/memos`: メモ一覧取得 (作成日時降順)
  - `DELETE /api/memos/{id}`: メモ削除

- **ファイル修正**: `backend/app/schemas.py`
  - Pydantic スキーマ追加: `PlanCreate`, `Plan`, `PlanItem`, `PlanItemUpdate`
  - Pydantic スキーマ追加: `MemoCreate`, `Memo`

- **ファイル修正**: `backend/main.py`
  - 新規ルーター登録: `/api/plans`, `/api/memos`
  - データベーステーブル初期化処理追加 (`Base.metadata.create_all()`)

#### 1.3 バグ修正: 500 Internal Server Error
- **問題**: フロントエンドから `/api/plans/` へのリクエストが 500 エラーを返す
- **原因分析**:
  1. `sqlalchemy` パッケージ未インストール → `ModuleNotFoundError`
  2. Next.js (末尾スラッシュなし) と FastAPI (末尾スラッシュあり) のルーティング不一致 → 無限リダイレクトループ

- **修正内容**:
  - `backend/requirements.txt` に `sqlalchemy` を追加
  - `backend/app/routers/plans.py`: `@router.post("/")` → `@router.post("")`
  - `backend/app/routers/memos.py`: `@router.get("/")` → `@router.get("")`
  - `backend/app/routers/chat.py`: `@router.post("/")` → `@router.post("")`
  - 理由: Next.js の `rewrites` は末尾スラッシュを自動削除するため、FastAPI 側も空文字列ルートで受け付けるよう統一

### 2. フロントエンド開発 (Next.js + React)

#### 2.1 API クライアント実装
- **ファイル修正**: `frontend/lib/api.ts`
  - Plans API 関数追加: `getPlans()`, `createPlan()`, `getPlan()`, `updatePlanItem()`
  - Memos API 関数追加: `getMemos()`, `createMemo()`, `deleteMemo()`
  - API ベース URL: `/api` (Next.js プロキシ経由)

#### 2.2 学習計画機能
- **ファイル作成**: `frontend/components/PlanListWidget.tsx`
  - ダッシュボード用ウィジェット
  - 最新3件の計画を表示、進捗バー付き
  - 「すべて見る」リンクで詳細ページへ遷移

- **ファイル作成**: `frontend/app/plans/page.tsx`
  - 学習計画一覧ページ
  - 全計画の表示、進捗率の可視化
  - 各計画へのリンク

- **ファイル作成**: `frontend/app/plans/[id]/page.tsx`
  - 計画詳細ページ
  - タスクのチェックリスト表示
  - チェックボックスで完了状態を更新 → API 経由で DB に保存
  - 進捗率のリアルタイム更新

- **ファイル修正**: `frontend/app/page.tsx`
  - 「📅 この内容で計画を作成」ボタンを AI メッセージに追加
  - `saveAsPlan()` 関数実装: AI 応答から箇条書きを抽出して計画作成
  - `PlanListWidget` コンポーネントの統合

#### 2.3 メモ機能
- **ファイル作成**: `frontend/components/MemoPad.tsx`
  - フローティングボタン (画面右下、黄色ペンアイコン)
  - クイックメモパネル (開閉式)
  - メモの作成、一覧表示、削除機能
  - ホバー時に削除ボタン表示

- **ファイル修正**: `frontend/app/page.tsx`
  - `MemoPad` コンポーネントの統合

#### 2.4 UI/UX 改善
- **問題**: メモボタンと音声入力ボタンが重なって操作不能
- **修正**: `frontend/components/MemoPad.tsx`
  - フローティングボタンの位置を `bottom-6` → `bottom-20` に変更
  - 音声入力ボタンとの縦方向スペースを確保

### 3. 依存関係とインフラ

#### 3.1 パッケージ追加
- **Backend**:
  - `sqlalchemy` (ORM、データベース操作)
  - `requirements.txt` に追記

#### 3.2 データベース
- SQLite ファイル: `backend/ai_tutor.db`
- テーブル:
  - `plans` (id, title, target, created_at)
  - `plan_items` (id, plan_id, content, is_completed)
  - `memos` (id, content, created_at)

### 4. 検証とテスト

#### 4.1 バックエンド検証
- `curl` を使用した直接 API テスト
  - `GET http://127.0.0.1:8000/api/plans/` → 200 OK, 空配列 `[]` 返却確認
  - リダイレクトループの解消確認

#### 4.2 フロントエンド検証
- ブラウザでの動作確認 (予定)
  - 学習計画の作成、一覧表示、詳細表示
  - タスクのチェック機能
  - メモの作成、削除
  - UI ボタンの重なり解消

## ■ 課題・次回の予定

### 残作業
- [ ] GitHub リポジトリの作成と初回コミット
- [ ] ブラウザでの総合的な動作確認 (学習計画、メモ機能)
- [ ] README.md の作成 (セットアップ手順、使い方)
- [ ] `.gitignore` の設定 (仮想環境、データベースファイル、環境変数)

### 次回開始作業
- [ ] ユーザー認証機能の検討 (複数ユーザー対応)
- [ ] 学習履歴の可視化 (グラフ、統計)
- [ ] AI による学習計画の自動生成機能の強化
- [ ] モバイル UI の最適化
- [ ] デプロイ環境の構築 (Docker, Cloud Run など)

### 技術的負債
- TypeScript の型定義エラー (Next.js Turbopack 環境での一時的な問題、動作には影響なし)
- 計画保存時のページリロード (`window.location.reload()`) → 状態管理の改善が望ましい

## ■ 仕様追加・変更

### 新規機能
1. **学習計画管理機能**
   - AI チャットから直接学習計画を保存
   - 計画一覧、詳細表示、進捗管理
   - チェックリスト形式でのタスク管理

2. **メモ機能**
   - フローティングボタンによるクイックアクセス
   - メモの作成、一覧、削除

### API 仕様変更
- **エンドポイント追加**:
  - `POST /api/plans` - 学習計画作成
  - `GET /api/plans` - 計画一覧取得
  - `GET /api/plans/{id}` - 計画詳細取得
  - `PUT /api/plans/{id}/items/{item_id}` - タスク更新
  - `POST /api/memos` - メモ作成
  - `GET /api/memos` - メモ一覧取得
  - `DELETE /api/memos/{id}` - メモ削除

- **ルーティング修正**:
  - FastAPI のルート定義を `"/"` から `""` に変更 (Next.js との互換性向上)

### データベーススキーマ
- 新規テーブル: `plans`, `plan_items`, `memos`
- SQLite を使用 (MVP 開発のため)
